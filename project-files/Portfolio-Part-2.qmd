---
title: "Portfolio Part 2: Data Cleaning and Rough Draft"
author: Michael Torrisi
format: html
editor: source
execute: 
  echo: true
  error: true
code-fold: true
toc: true
---

```{r}
library(tidyverse)
library(purrr)
```


# Portfolio: Data Cleaning and Rough Draft

The Portfolio component is a place for you to put your R skills into action on a problem you are interested in with the goal of have a project you could share with future employers.

It should have the following qualities:

-   It is a real-world application of R that has not exactly been worked out before (e.g. it isn't a demo from some package or blog).\
-   It is interesting to you.\
-   It involves data and analyzing or presenting that data. The data may be data you have from a lab, or something you have retrieved from the web, some examples of good sources: FBI database on crime statistics, National Oceanic and Atmospheric Administration, World Health Organization, Twitter, Yahoo finance data, etc. If you are having problems finding a dataset, see the resources at the end of the project description.\
-   The analysis and presentation is useful in the real-world.

These are real-world projects, but they are also class projects and there can be unforeseen unknowns, if you find that it is going to be impossible to finish what you set out to accomplish, please contact your instructor to find a solution.



## Portfolio Expectations

The final product will be a website page, hosted on your personal website, the includes the following content:

-   Description of the proposed research questions\
-   Description of the data and data source(s)\
-   Description of data cleaning\
-   2-3 data visualizations with commentary that answer the research questions

Though no code should be visible on the website, the quarto document used to create the final product should contain all code for data cleaning and data visualization, commented and following a coding style conventions.

## Part 1 - Data Cleaning

Begin the process of cleaning your data. Be sure to comment on the code with the reason why you are making your modifications. It is possible you will need to transform your data in a few different ways to make the data visualizations you planned to create, so you might have 1-3 different 'final' clean data sets.

Each clean data set should be exported and saved in a folder within the project.

Remember there needs to be at minimum 3 data transformations to meet the requirements of the project.

```{r}
IMO_data <- read_csv("data-raw/individual_results_df.csv")
country_continents <- read_csv("data-raw/list-of-countries-by-continent-2025.csv")
```
```{r}
IMO_alltime_gold <- IMO_data %>% 
  mutate(award = substring(award, 1, 4),
         name_lenth = str_length(country)) %>% 
  filter(award == "Gold" | award == "Bron" | award == "Silv") %>% 
  filter(name_lenth > 3) %>% 
  mutate(award = case_when(award == "Gold" ~ "Gold",
                           award == "Silv" ~ "Silver",
                           award == "Bron" ~ "Bronze")) %>% 
  select(year, country, award) %>% 
  group_by(country) %>% 
  summarise(alltime_gold = n(), .groups = "drop") %>% 
  arrange(desc(alltime_gold))
```


```{r}
IMO_21stcentury_gold <- IMO_data %>% 
  filter(year >= 2000) %>% 
  mutate(award = substring(award, 1, 4),
         name_lenth = str_length(country)) %>% 
  filter(award == "Gold" | award == "Bron" | award == "Silv") %>% 
  filter(name_lenth > 3) %>% 
  mutate(award = case_when(award == "Gold" ~ "Gold",
                           award == "Silv" ~ "Silver",
                           award == "Bron" ~ "Bronze")) %>% 
  select(year, country, award) %>% 
  group_by(country) %>% 
  summarise(century21_gold = n()) %>% 
  arrange(desc(century21_gold))
```

```{r}
IMO_20thcentury_gold <- IMO_data %>% 
  filter(year < 2000) %>% 
  mutate(award = substring(award, 1, 4),
         name_lenth = str_length(country)) %>% 
  filter(award == "Gold" | award == "Bron" | award == "Silv") %>% 
  filter(name_lenth > 3) %>% 
  mutate(award = case_when(award == "Gold" ~ "Gold",
                           award == "Silv" ~ "Silver",
                           award == "Bron" ~ "Bronze")) %>% 
  select(year, country, award) %>% 
  group_by(country) %>% 
  summarise(century20_gold = n()) %>% 
  arrange(desc(century20_gold))
```

```{r}
IMO_gold_counts <- IMO_alltime_gold %>% 
  full_join(IMO_20thcentury_gold, by = "country") %>% 
  full_join(IMO_21stcentury_gold, by = "country") %>% 
  mutate_if(is.integer, ~replace(., is.na(.), 0))
```

```{r}
write_csv(IMO_gold_counts, "data-clean/IMO_gold_counts.csv")
```


## Part 2 - Data Visualization  

Attempt to create a rough draft of at least one of your proposed visualizations.  Identify anything you want to modify in your visualization, but do not know how to do.


```{r}
IMO_data %>% 
  select(p1, p2, p3, p4, p5, p6, p7, year) %>% 
  group_by(year) %>% 
  summarise(p1 = mean(p1, na.rm = TRUE),
            p2 = mean(p2, na.rm = TRUE),
            p3 = mean(p3, na.rm = TRUE),
            p4 = mean(p4, na.rm = TRUE),
            p5 = mean(p5, na.rm = TRUE),
            p6 = mean(p6, na.rm = TRUE)) %>% 
  pivot_longer(cols = 2:7, names_to = "problem_num", values_to = "mean_score") %>% 
  ggplot(aes(x = year, y = mean_score)) + 
  geom_line() +
  facet_grid(rows = vars(problem_num)) +
  labs(x = "Year",
       y = "Mean Score") +
  theme_light()
```


```{r}
IMO_data %>% 
  left_join(country_continents, by = "country") %>% 
  mutate(continent = case_when(country == "People's Republic of China" ~ "Asia",
                               country == "United States of America" ~ "North America",
                               country == "Republic of Korea" ~ "Asia",
                               country == "TÃ¼rkiye" ~ "Asia",
                               country == "Islamic Republic of Iran" ~ "Asia",
                               country == "Republic of Moldova" ~ "Europe",
                               country == "Kosovo" ~ "Europe",
                               country == "Russian Federation" ~ "Asia",
                               country == "Democratic People's Republic of Korea" ~ "Asia",
                               country == "Serbia and Montenegro" ~ "Europe",
                               country == "Yugoslavia" ~ "Europe",
                               country == "Turkish Republic of Northern Cyprus" ~ "Asia",
                               country == "Yugoslavia" ~ "Europe",
                               country == "Czechoslovakia" ~ "Europe",
                               country == "Union of Soviet Socialist Republics" ~ "Asia",
                               country == "German Democratic Republic" ~ "Asia",
                               continent == "Oceania" ~ "Australia",
                              TRUE ~ continent)) %>% 
  filter(!is.na(continent)) %>% 
  select(p1, p2, p3, p4, p5, p6, p7, year, continent) %>% 
  group_by(continent, year) %>% 
  summarise(p1 = mean(p1, na.rm = TRUE),
            p2 = mean(p2, na.rm = TRUE),
            p3 = mean(p3, na.rm = TRUE),
            p4 = mean(p4, na.rm = TRUE),
            p5 = mean(p5, na.rm = TRUE),
            p6 = mean(p6, na.rm = TRUE)) %>% 
  pivot_longer(cols = 3:8, names_to = "problem_num", values_to = "mean_score") %>% 
  mutate(mean_score = case_when(mean_score == "NaN" ~ NA,
                                TRUE ~ mean_score)) %>% 
  filter(continent != "Oceania") %>% 
  ggplot(aes(x = year, y = mean_score)) + 
  geom_line() +
  facet_grid(rows = vars(problem_num), cols = vars(continent)) +
  labs(x = "Year",
       y = "Mean Score") +
  theme_light()
  
```

